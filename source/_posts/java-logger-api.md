---
title: Java日志API
categories: [Java基础]
tags: [Java]
date: 2019-10-08 21:36:58
---

在编写程序时，经常需要使用输出工具（例如常用的`System.out.println()`）来输出、记录或者对比某些变量的值，在程序的运行期间，需要记录一些关键日志信息来调试、监控或者方便以后排查问题，此时，一般输出语句无法满足日志记录的需求，因此，Java内部提供了一套用于日志记录的API.

<!-- more -->

## 日志API提供的好处

---

使用专门的日志工具来记录日志可以极大的提高这项工作的灵活性，例如：

- 日志信息更加统一、标准
- 可以配置记录等级（如只记录错误信息，忽略调试信息）
- 可以更容易的定位错误日志发生的位置
- 可以更方便的配置日志保存的位置

## 记录简单的日志

---

需要记录一个日志只需要简单的几个步骤：

1. 获取日志记录器

   ```java
   // 获取全局日志记录器
   Logger logger = Logger.getGlobal();
   ```

2. 打印指定级别的日志

   ```java
   logger.info("global message");
   ```

这样，在程序中插入这条日志记录语句，控制台就会输出打印日志的具体类，具体方法以及自定义的日志信息.

## 日志级别

---

日志API中定义了几个日志级别来帮助我们打印不同重要程度的日志：

- SEVERE
- WARNING
- INFO
- CONFIG
- FINE
- FINER
- FINEST

这些级别中，最严重的是SEVERE级别，最普通的是FINEST级别，当程序发生严重错误时，应该记录SEVERE级别的日志，进行调试时或记录一般信息时，可以记录INFO级别或者更低级别(如FINE)的日志.

### 配置日志记录级别

获取日志记录器后，可以使用`Logger`对象提供的`setLevel()`方法设置记录的最大级别，例如：

```java
logger.setLevel(Level.WARNING);
```

这样级别在WARNING以下的日志将不会记录，例如：

```java
logger.info("info log"); // 不会打印
```

## 日志记录器的层次结构

---

获取日志记录器时，一般不使用`Logger.getGlobal()`来获取并使用全局日志记录器，通常情况下，应该为日志记录器提供一个名称，例如：

```java
Logger.getLogger("com.example.tech");
```

全局记录器也是一个普通的记录器，只是其名称为`global`：

```java
Logger.getGlobal() == Logger.getLogger("global");	// true
```

需要注意的是，这个像包名一样的名称还代表这一个层次结构，如名字为`com.example`的日志记录器就是`com.example.tech`的父级记录器，父级和子级之间存在着配置继承关系，例如在子级记录器中没有配置日志记录级别，则会默认使用父级设置的级别.

### 获取父记录器及根日志记录器

可以使用`Logger`对象的`getParent()`来获取当前记录器的父记录器，日志记录器的层次结构类似于类的继承关系，所有类都有一个公共父类`Object`，类似的，所有日志记录器都有个公共父记录器：

```java
Logger.getLogger("");	// 根日志记录器
```

所有的日志记录器都是其子级，包括全局记录器（因为全局记录器只是名字为`global`的普通记录器），根日志记录器有默认配置(如默认的日志记录级别为INFO)，每次获取的日志记录器将默认使用该默认配置.

**根日志记录器的默认配置文件位于JDK目录下的`jre/lib/logging.properties`，可以通过修改该文件中的配置来修改所有日志记录器的默认配置.**

## 日志处理器(Handler)

---

可以将日志记录器看成一个日志信息的收集器，记录器只是收集指定级别的日志，这些日志应该输出到什么地方则交由日志处理器来处理，`Logger`对象中定义了`addHandler()`方法用于向一个日志记录器添加处理器.

### 预定义的日志处理器

- ConsoleHandler

  该处理器会将日志输出到控制台中，默认的日志记录器就带有该处理器，因此，无需任何配置，记录日志时，控制台就会打印信息.

- FileHandler

  该处理器用于将日志输出到文件中.

- SocketHandler

  该处理器用于将日志输出到Socket连接中.

- StreamHandler

  该处理器用于将日志输出到指定输出流中，ConsoleHandler、FileHandler、SocketHandler就是继承自该处理器.

- MemoryHandler

  该处理器用于将日志临时缓存在内存中(最大缓存1000条，超出后，旧的将被新的覆盖)，在调用`push()`方法时，缓存的日志将被输出到其它配置好的处理器中，此外，该处理器有个主动输出级别阀值(PushLevel，可调用`setPushLevel()`配置)，当记录的日志级别等于或高于该阀值时，就会主动调用`push()`.

如果有特殊需求，可以自己继承`java.util.logging.Handler`来自定义一个日志处理器.

### 日志处理器的级别

日志记录器只收集指定级别的日志，日志处理器也需要配置只处理指定级别的日志(默认为INFO)，它们之间互相独立，多个日志处理器之间也可以分别设置不同的处理级别. `Handler`对象提供了`setLevel()`方法用于设置处理器的处理级别.

### 日志处理器的过滤器



### 日志处理器的格式化器

